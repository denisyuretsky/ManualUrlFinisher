(()=>{"use strict";var e=function(e,t,n,r){return new(n||(n=Promise))((function(o,c){function a(e){try{l(r.next(e))}catch(e){c(e)}}function s(e){try{l(r.throw(e))}catch(e){c(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};let t=[],n="",r={};const o=document.getElementById("muf-options-result"),c=document.getElementById("muf-history-list"),a=document.getElementById("muf-history-clear-all"),s=()=>{const e=t.map((e=>-1==e?"X":e)).join("");return o.textContent=e,e},l=e=>{chrome.tabs.create({url:`${n}${e}`}).catch((e=>{}))},i=(t,n,o)=>{switch(t){case"add":(e=>{var t;const n=Date.now();r[e]=null!==(t=r[e])&&void 0!==t?t:{count:0,timestamp:n},r[e].count++,r[e].timestamp=n;const o=Object.keys(r).map((e=>Number(e)));if(o.length>10){const e=o.reduce(((e,t)=>r[e].timestamp<r[t].timestamp?e:t));delete r[e]}})(Number(n));break;case"delete":Object.prototype.hasOwnProperty.call(r,Number(n))&&delete r[Number(n)];break;case"clearAll":r={}}var c;(c={history:r},e(void 0,void 0,void 0,(function*(){return new Promise(((e,t)=>{chrome.storage.local.set(c,(()=>{chrome.runtime.lastError&&t(new Error(chrome.runtime.lastError.message)),e()}))}))}))).then((()=>{d(),o&&"string"==typeof n&&n.length>0&&o(n)})).catch((e=>{}))},m=(e,t)=>{const n=document.createElement("li");return n.className="muf-history-item",n.textContent=`${e}${t.count>1?` (${t.count})`:""}`,((e,t)=>{const n=document.createElement("span");n.className="clear-icon",n.innerHTML="&#128711;",n.title="Delete",n.addEventListener("click",(e=>{e.stopPropagation(),i("delete",t)})),e.appendChild(n)})(n,e),n.addEventListener("click",(()=>{i("add",e,l)})),n},d=()=>{c.innerHTML="";const e=Object.entries(r).sort((([,e],[,t])=>t.timestamp-e.timestamp));if(0===e.length)return;const t=document.createDocumentFragment();e.forEach((([e,n])=>t.appendChild(m(e,n)))),c.appendChild(t)},u=e=>{const{cellIndex:n,innerText:r}=e.target;t[n]=Number(r);const o=s();t.every((e=>e>=0))&&i("add",o,l)},h=()=>{((...t)=>e(void 0,[...t],void 0,(function*(e={contentUrl:"",numbers:Array(4).fill(-1),history:{}}){return new Promise(((t,n)=>{chrome.storage.local.get(e,(e=>{chrome.runtime.lastError&&n(new Error(chrome.runtime.lastError.message)),t(e)}))}))})))().then((e=>{const o=document.getElementById("muf-options-table");t=[...e.numbers],n=e.contentUrl,r=e.history,e.numbers.forEach(((e,t)=>{var n;const r=null===(n=o.rows[e])||void 0===n?void 0:n.cells[t];e>=0&&r&&r.classList.add("selected")})),s(),d()})).catch((e=>{}))};document.addEventListener("DOMContentLoaded",(()=>{h(),document.querySelectorAll("td").forEach((e=>{e.addEventListener("click",u)})),a.addEventListener("click",(()=>{i("clearAll")}))}))})();