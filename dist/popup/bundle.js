(()=>{"use strict";let e=[],t="",r={};const n=document.getElementById("muf-options-result"),o=document.getElementById("muf-history-list"),c=document.getElementById("muf-history-clear-all"),s=()=>{const t=e.map((e=>-1==e?"X":e)).join("");return n.textContent=t,t},a=e=>{chrome.tabs.create({url:`${t}${e}`})},l=(e,t,n)=>{switch(e){case"add":(e=>{const t=Date.now();r[e]=r[e]||{count:0,timestamp:t},r[e].count++,r[e].timestamp=t;const n=Object.keys(r).map((e=>Number(e)));if(n.length>10){const e=n.reduce(((e,t)=>r[e].timestamp<r[t].timestamp?e:t));delete r[e]}})(Number(t));break;case"delete":r.hasOwnProperty(Number(t))&&delete r[Number(t)];break;case"clearAll":r={}}var o;(o={history:r},new Promise(((e,t)=>{chrome.storage.local.set(o,(()=>{if(chrome.runtime.lastError)return t(chrome.runtime.lastError);e()}))}))).then((()=>{i(),n&&t&&n(t)}))},m=(e,t)=>{const r=document.createElement("li");return r.className="muf-history-item",r.textContent=`${e}${t.count>1?` (${t.count})`:""}`,((e,t)=>{const r=document.createElement("span");r.className="clear-icon",r.innerHTML="&#128711;",r.title="Delete",r.addEventListener("click",(e=>{e.stopPropagation(),l("delete",t)})),e.appendChild(r)})(r,e),r.addEventListener("click",(()=>l("add",e,a))),r},i=()=>{o.innerHTML="";const e=Object.entries(r).sort((([,e],[,t])=>t.timestamp-e.timestamp));if(0===e.length)return;const t=document.createDocumentFragment();e.forEach((([e,r])=>t.appendChild(m(e,r)))),o.appendChild(t)},d=t=>{const{cellIndex:r,innerText:n}=t.target;e[r]=Number(n);const o=s();e.every((e=>e>=0))&&l("add",o,a)},u=()=>{((e={contentUrl:"",numbers:Array(4).fill(-1),history:{}})=>new Promise(((t,r)=>{chrome.storage.local.get(e,(e=>{if(chrome.runtime.lastError)return r(chrome.runtime.lastError);t(e)}))})))().then((n=>{var o=document.getElementById("muf-options-table");e=[...n.numbers],t=n.contentUrl,r=n.history,o&&n.numbers.forEach(((e,t)=>{var r;e>=0&&(null===(r=o.rows[e])||void 0===r?void 0:r.cells[t])&&o.rows[e].cells[t].classList.add("selected")})),s(),i()}))};document.addEventListener("DOMContentLoaded",(()=>{u(),document.querySelectorAll("td").forEach((e=>e.addEventListener("click",d))),c.addEventListener("click",(()=>l("clearAll")))}))})();